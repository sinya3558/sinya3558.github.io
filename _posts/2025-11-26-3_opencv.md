---
title: "OpenCV (3) : 객체 검출 (Edge / Line / Labeling)"
description: "전진·후진·중앙 차분, Sobel/Canny 엣지 검출, Hough Transform 기반 직선·원 검출, 실시간 영상 처리 기법을 정리한 OpenCV Part.3"
author: Seunga Kim
date: 2025-11-26
categories: [Computer Vision, OpenCV]
tag: [Edge Detection, Sobel, Canny, Hough Transform]
image: /assets/img/space-invaders.png
toc: true
toc_label: "Table of Contents"
author_profile: true
comments: false
---

#### 📚 참고 자료

- 🔗두산 로키 5기 AI 교육 자료
- 🔗[OpenCV modules](https://docs.opencv.org/4.x/index.html)
- 🔗[Forward, backward, central difference](https://youtu.be/Jqa-aFE9-GI) - @ 11:00 ~
- 🔗[Sobel filter](https://www.youtube.com/watch?v=uihBwtPIBxM)
- 🔗[Hough transform](https://m.blog.naver.com/kwy44/221881417258)

# 23. OpenCV (3) : 동영상 처리 & 객체 추적 Part.1

> 주제 : (1) **단일 영상 내 객체 검출의 원리를 이해**하고, (2) **이를 동영상 스트림에서 실시간으로 객체를 검출**하는 기술로 확장

### 세부 내용

1. 전진 차분, 후진 차분, 중앙 차분 (차분 == 미분)

2. 소벨 (Sobel) 필터를 이용한 영상 에지 검출

3. Canny edge 를 이용한 영상 에지 검출

4. Hough transform 을 이용한 영상 직선 및 원 검출

5. ~~연결객체검출과 외곽선 검츨~~ (Part.2)

6. ~~Hu's invariant momemtum 을 이용한 영상 객체 검출~~ (Part.2)

7. ~~배경 차분과 이동평균 배경 차분~~ (Part.2)

8. ~~Webcam 을 통한 실시간 동영상 다루기~~ (Part.2)

---

## 23-1. Forward Difference, Backward Difference, Central Difference (차분) 엣지 검출

> **물체의 엣지를 검출하는 목적**으로 사용된다. 영상에서 엣지는 픽셀 밝기의 급격한 변화로 정의된다.

- 데이터 (2x2 데이터에서 x축만 가져옴) : 

    ![스크린샷 2025-11-25 162315.png](/assets/img/opencv/3_opencv_files/스크린샷%202025-11-25%20162315.png)

- 만약 기울기 변화가 0 이라면 -> 변화 없음
- 만약 기울기 변화가 + 2.5 라면 -> 밝기 증가 시작

1. 전진 차분 (Forward)

    ![스크린샷 2025-11-25 161814.png](/assets/img/opencv/3_opencv_files/스크린샷%202025-11-25%20161814.png)

    > 현재 픽셀과 다음 픽셀의 차이를 사용 → 간단하지만 노이즈에 약함

    - 엣지 찾기 : 간단함. `자기 자신`과 `한 단계 이후의(forward) 자신`과의 차이를 가지면, 기울기 값 생기고(부호 차이 있음), 차이가 없으면 기울기는 0

2. 후진 차분 (Backward)

    ![스크린샷 2025-11-25 161826.png](/assets/img/opencv/3_opencv_files/스크린샷%202025-11-25%20161826.png)

    > 현재 픽셀과 이전 픽셀의 차이를 사용

    - 엣지 찾기 : `자기 자신`과 `한 단계 이전의(backward) 자신`과 차이가 있다면, 기울기 생기고 (부호 차이 잇음), 차이가 없으면 기울기 0


3. 중앙 차분 (Central)

    - ***중앙 차분 == Sobel Edge***

    ![스크린샷 2025-11-25 161831.png](/assets/img/opencv/3_opencv_files/스크린샷%202025-11-25%20161831.png)

    > 이전·다음 픽셀을 모두 사용해 평균 기울기 계산 → Sobel 필터의 기본 개념과 동일, 노이즈에 강함

    - 엣지 찾기 : `한 단계 이후의 자신(forward)`과 `한 단계 이전의 자신(backward)`의 차이를 구하고, 2*h 로 나누어 **평균을 구한 값**이 기울기가 된다

    - { f(x+h) - f(x) + f(x) - f(x-h) }/ 2*h = 중앙차분

    - 노이즈를 잘 잡아준다

## 23-2. Sobel 필터 기반 엣지 검출

### 영상과 1차 미분

![image.png](/assets/img/opencv/3_opencv_files/스크린샷%202025-11-25%20161758.png)       ![image-2.png](/assets/img/opencv/3_opencv_files/스크린샷%202025-11-25%20171909.png)

- <u>영상은 음수 데이터 값 표현을 못하기 떄문에</u>, 1차 미분값이 음수값이라면 절대값 씌워 사용


### 영상 1차 미분을 이용한 엣지 검출

![image.png](/assets/img/opencv/3_opencv_files/스크린샷%202025-11-25%20172523.png)

1. (a) : 원본 영상의 <u>픽셀 ***밝기*** 변화</u>
    - 1차원적인 형태로, 영상에서 한 줄의 픽셀 밝기 (Intensity) 변화 'a' 지점을 중심으로 밝기 값이 증가하는 S-curve (sigmoid-like curve) 엣지를 묘사함 

2. (b) : fx(x, y)
    - 원본 영상 픽셀 밝기(a) 에 대한 1차 미분 값
    - 밝기 변화가 급격한 'a' 지점 => 미분 값이 최대가 된다
    - 밝기 변화가 없는 평탄한 구간은 미분 값이 0 에 가까워 진다

3. (c) : I(x, y)
    - 미분 값에 대한 히스토그램 또는 양자화된 미분 값
    - 'a' 지점에서 미분값이 가장 높게 나타남
    - 빨간색 직선 (T) = 임계값 (threshold), 임계값 이상인 값들만 경계로 판단하겠다는 의미
        - ***Sobel 필터***는 임계값 이상인 값들을 <u>*전부 엣지로 판단*</u>한다 ( Sobel 의 판단 근거 : 밝기의 변화가 있는 구간은 엣지다!)
        - 이러한 <u>sobel 필터의 한계를 극복하기 위해</u> 나타난 것이 ***Canny 필터***

## 23-2. 엣지검출 : 소벨(Sobel) 필터

- Sobel filter 의 특징 : X, Y - Direction Kernel 이 존재

    ![image.png](/assets/img/opencv/3_opencv_files/스크린샷%202025-11-25%20173033.png)


- sobel x-dir / original / sobel y-dir 결과 비교

    ![image-3.png](/assets/img/opencv/3_opencv_files/스크린샷%202025-11-25%20174411.png)

    ![image-4.png](/assets/img/opencv/3_opencv_files/스크린샷%202025-11-25%20174449.png)

- magnitude of gradient :

    1. Gradient matnitude :

        ![image-5.png](/assets/img/opencv/3_opencv_files/스크린샷%202025-11-25%20175919.png)

        - pythagoras' theorem -> G = sqrt(G_x^2 + G_y^2)
            - G_x, G_y : 함수 f(x, y)를 x 축과 y 축으로 각각 편미분 (partial derivative) 하여 벡터 형태로 표현한 것
            - 영상이 음수값 기울기를 표현할 수 없어서 abs 값을 받음

            ![image-6.png](/assets/img/opencv/3_opencv_files/스크린샷%202025-11-25%20180314.png)
            

    2. Gradient angle :

        ![image-2.png](/assets/img/opencv/3_opencv_files/스크린샷%202025-11-25%20175837.png)

        - edge detection = inverse_tan(G_y/G_x)

- Sobel 로 Edge 검출 :

    - ***엣지 검출 순서*** : 

        1. Sobel 은 grayscale operator -> convert image into Grayscale first
        2. Sobel 은 very noisy >> Gussian filter  필요 -> Gaussian blur filter 로 high frequency 제거하고 low frequency 보존
        3. Sobel edge detection

- original / edge dtection by sobel 결과 비교

![스크린샷 2025-11-25 175040.png](/assets/img/opencv/3_opencv_files/스크린샷%202025-11-25%20175040.png) ![스크린샷 2025-11-25 175105.png](/assets/img/opencv/3_opencv_files/스크린샷%202025-11-25%20175105.png)
 
> Sobel은 간단하고 빠르지만 임계값 이상을 모두 엣지로 간주하는 단점이 있다 → 이를 보완한 것이 Canny

---

## 23-3. Canny edge 를 이용한 영상 에지 검출

### Canny Edge

> radian 이 보통이랑 반대쪽 방향 (시계방향) 인거 조심 -> 부호 조심

![image.png](/assets/img/opencv/3_opencv_files/스크린샷%202025-11-25%20215405.png)

- 빨간색 사각형(경계 픽셀) 에서 뻗어나가는 주황색 화살표 -> 해당 지점에서의 Gradient Direction 을 나타낸다
- Gradient dir (주황색 화살표) 은 ***픽셀 밝기 (intensity)*** 가 가장 ***급격하게 변하는 방향***을 의미하며, 이는 곧 경계선에서 수직인 방향이다

- ***작동 원리*** :
    - 좌상단의 픽셀에서는 밝기가 오른쪽으로 급격히 변한다 >> gradient direction 은 왼쪽을 향하는 -pi (또는 pi) 방향으로 표시된다
    
    - 가운데 픽셀에서는 대각선 방향으로 향하면서 픽셀의 밝기가 변한다 >> gradient direction 은 3*pi/4 방향을 나타낸다
    
    - 가장 아래쪽 픽셀에서는 위에서 아래로 밝기가 변한다 >> gradient dir : pi/2 방향을 나타낸다

- ***방향 찾는 법*** : 

    1. gradient direction 계산 : 

        ![스크린샷 2025-11-25 175837.png](/assets/img/opencv/3_opencv_files/스크린샷%202025-11-25%20175837.png)

- ***최종 결과*** :
    - 픽셀 중에서 가장 큰 intensity (max. intensity) 값만 남긴다
        - NMS 의 결과

            ![image-2.png](/assets/img/opencv/3_opencv_files/스크린샷%202025-11-25%20220444.png)

### Canny Edge Detection

> Canny는 다음 단계로 진행된다

1. ***Gaussian Blur*** 로 노이즈 제거

2. ***Sobel*** 미분으로 기울기 계산

3. ***Non-max suppression*** (가장 강한 엣지만 남김)

4. Hysteresis Thresholding (***두 개의 임계값 사용***)

### Canny Edge Criteria

![image.png](/assets/img/opencv/3_opencv_files/스크린샷%202025-11-25%20220848.png)

> Edge 인지 구별하는 방법 (Hysteresis thresholding) : 두 개의 임계값 사용

1. Magnitude 값이 100 이하라면 : Low >> Edge 라고 인식 x

2. 100 < magnitude < 150 : 
    1. 중간 범위에만 존재한다면 >> Edge x
    2. 중간 범위에 존재하다가 어느 부분에서 150 이상이라면 >> Edge o

3. Magnitude 값이 150 이상이라면 : High >> 무조건 Edge 라고 인식

---

## 23-4. Hough transform 을 이용한 직선 및 원 검출

> Hough Transform은 이미지 상의 점들을 파라미터 공간으로 변환하여
직선/원의 존재를 투표(voting) 방식으로 찾는 알고리즘이다

> 사용되는 목적 : 이미지 또는 영상 안에서의 직선 검출

#### 특징

- 직선 검출: 극좌표계(ρ, θ)를 사용

- 이미지에서 검출하기 어려운 직선을 파라미터 공간에서 교차점으로 찾을 수 있음

- 차선 인식, 체스판 인식 등에 폭넓게 활용됨


##### 용어 정리 : 

1. 직교좌표 (Rectangular coordinates) - P(x, y)
2. 극좌표 (Polar coordinates)   

![image-8.png](/assets/img/opencv/3_opencv_files/image-8.png)

- 이미지에 존재하는 직선 검출 :

    ![image.png](/assets/img/opencv/3_opencv_files/image.png)

    - 실제로 이미지에서 직선 검출이 매우 힘듦 >> 변환 후, 직선 검출한다

- 변환 원리 :

    ![image-2.png](/assets/img/opencv/3_opencv_files/image-2.png)

    1. 그래프 1(왼쪽) : 직선상에 2 개의 coordinates -> 직선의 방정식으로 표현 가능하다
        - 이 직선의 방정식 그래프를

            ![image-3.png](/assets/img/opencv/3_opencv_files/image-3.png)

        - x축 기준으로 y 값들을 뒤짚은(flip) 형태이다

            ![image-4.png](/assets/img/opencv/3_opencv_files/image-4.png)

    2. y 에 대한 방정식 y = a*x + b 를 <=> b 에 대한 방정식 b = -a*x + y 으로 치환

        - b 에 대한 직선의 방정식 그래프

            ![image-5.png](/assets/img/opencv/3_opencv_files/image-5.png)

            - 주황색 : 좌표 (x_j, y_j) 에 대한 각각 a, b 절편값을 잇는 직선
            - 빨간색 : 좌표 (x_i, y_i) 에 대한 각각 a, b 절편값을 잇는 직선
            ------------------------------------------------------
            - 동일한 직선 위에 여러 직선들이 겹치는 점 >> ***이미지 공간에서의 직선*** (a 와 b 의 공간)
                - 즉, **parameters 공간**에서 <-> **이미지 공간**으로 변환 :  `Hough Transform`

                    - 그러나, 이러한 방식에 <u>문제점이 존재한다.</u> 이미지 공간에서 동일한 x 좌표 위 위에서 아래로 y 축 값만 변하는 직선은 검출이 되지 않는다 -> 이를 보안하기 위해 극좌표계를 사용한다

### Hough Transform : 직선 검출 : 극좌표계 (Polar coordinates)로 나타내기

![image-6.png](/assets/img/opencv/3_opencv_files/image-6.png)

- 🧊 위 Hough transform (허프 변환) 은 이미지의 각 픽셀 점을 (p - theta) 공간의 사인 곡선으로 변환

- 🧊 x-y 공간에서 (parameter 공간)에서 동일한 직선을 이루는 점들은 (p - theta) 공간에서 모두 한 점 (p_0, theta_0) 에서 교차하며, 이 ***교차점***이 바로 <u>원본 이미지의 직선을 나타내는 거리와 각도</u> 이다

1. parameter 공간 = 직교좌표계 (rectangular)

    ![image-9.png](/assets/img/opencv/3_opencv_files/image-9.png)

2. parameter 공간 = 극좌표계 (polar)

    > 실제 범용적으로 사용하는 좌표계 ✔️

    ![image-10.png](/assets/img/opencv/3_opencv_files/image-10.png)

    - 인풋 이미지와 그에 따른 극좌표계에서의 공간변화 및 직선 교차 모습

        - 직좌표계와 극좌표계는 <u>동일한 값을 다르게 표현</u>한다

        ![image-7.png](/assets/img/opencv/3_opencv_files/image-7.png)

