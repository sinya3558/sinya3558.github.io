---
title:  "OpenCV (2) : 기하학적 변환 (Affine / Perspective)"
description: "OpenCV를 이용한 Affine 변환, Perspective 변환, 보간법(Nearest, Average, Bilinear, Cubic)을 정리한 글 Part.2"
author: Seunga Kim
date: 2025-11-25
categories: [Computer Vision, OpenCV]
tag: [Affine Transform, Perspective Transform, Interpolation]
image: /assets/img/space-invaders.png
toc: true
toc_label: "Table of Contents"
author_profile: True
comments: false
---

##### 📚 Reference: 
- 🔗 두산 로키 5기 강의자료


# 22. OpenCV 를 이용한 기하학적 변환 Part.2

> Geometric transform : 영상의 밝기(intensity) 를 그대로 두고, 영상이 가지고 있는 픽셀의 위치를 변환하는 과정

1. ~~평균 필터링, *가우시안* 필터링 원리~~ (Part.1)

2. ~~*샤프닝* 필터링, 양방향 필터링 원리~~ (Part.1)

3. Affine transform 과 동차좌표계

4. 위치 이동, 회전이동

5. 영상확대, 전단변환 (Shearing)

6. OpenCV 를 이용한 영상 필터링

7. OpenCV 를 이용한 영상 Affine 변환

8. (Optional) OpenCV 를 이용한 영상 비선형변환 (Perspective transform)

---

## 기하학적 변환

- 영상 기하학적 변환 (Geometric Transform in Image Processing) 은 이미지의 **픽셀 위치를 변경**하여 이미지의 크기, 방향, 모양 등을 조작하는 과정
- 이러한 변환은 이미지 정렬, 보정, 특수 효과 생성 등 다양한 컴퓨터 비전 및 이미지 처리 응용 분야에서 필수적으로 사용

> 이미지는 크게 두 가지 방식으로 변환된다

![image1](/assets/img/opencv/2_opencv22_files/스크린샷%202025-11-25%20094844.png)

1. Affine Transform (선형 변환)
    
2. Perspective Transform (비선형 변환)

# 22-3. Affine Transform 과 Homogeneous Coordinate System (동차좌표계)

## Affine Transform : ***선형 변환***

- Affine 변환은 하나의 변환 방식이 아닌, (1) 회전, (2) 이동, (3) 확대&축소, (4) 기울이기(Shearing, Skew) 변환 등을 모두를 포함하는 변환을 뜻한다

![image.png](/assets/img/opencv/2_opencv22_files/스크린샷%202025-11-25%20095132.png)

- 즉, Affine 변환은 휘어짐이 없고 평행한 선들은 평행을 유지하고 이동, 회전, 스케일 및 이들의 조합에 의한 변환이다

- 움직임이 정형화 되어있다 : *직직평평*
    1. 직선은 직선으로 유지되며
    2. 평행한 선분은 변환 후에도 평행을 유지한다

- 예시 이미지 :

    ![image-2.png](/assets/img/opencv/2_opencv22_files/스크린샷%202025-11-25%20095156.png)

    - Scaling : 이미지의 크기를 확대 또는 축소하는 변환
    - Rotation : 이미지를 특정 중심점을 기준으로 회전시키는 변환
    - Translation (이동) : 이미지를 한 위치에서 다른 위치로 옮기는 변환
    - Skew (기울이기) : 이미지를 한 축 또는 두 축을 따라 비틀어 기울어지게 만드는 변환

    > Scaling, Rotation, Translation, Skew 등이 모두 Affine Transform에 속한다

# 22-4. 위치 이동, 회전이동

### 위치 이동 (Translation)

- 평행 이동 변환 행렬은 아래와 같이 표현된다

    ![스크린샷 2025-11-25 102544.png](/assets/img/opencv/2_opencv22_files/스크린샷%202025-11-25%20102544.png)

    - 여기서 1 & 2 의 빨간 네모 박스가 **동차좌표계**(homogeneous coordinates) 이며, 로봇 팔의 위치 계산에서도 동일한 원리의 행렬 연산이 사용된다  

- **점 (1, 1)** 을 이동시킨 예시는 아래와 같다

    ![스크린샷 2025-11-25 102615.png](/assets/img/opencv/2_opencv22_files/스크린샷%202025-11-25%20102615.png)

### 회전 변환 (Rotation)

> 이미지를 특정 중심점을 기준으로 시계/반시계 방향으로 회전시키는 변환

![image-3.png](/assets/img/opencv/2_opencv22_files/image-3.png)

![image.png](/assets/img/opencv/2_opencv22_files/image-2.png)

![image-2.png](/assets/img/opencv/2_opencv22_files/image.png)


# 22-5. 영상확대, 전단변환 (Shearing)
### 확대 축소 변환 (Scaling)

> 확대는 **존재하지 않는 픽셀을 채워넣어야 하기 때문에** 보간(interploation) 과정이 필요

![image-4.png](/assets/img/opencv/2_opencv22_files/image-4.png)

### 영상 보간법 종류

#### 영상 보간법 (1) : Nearest Neighbor Interpolation (NNI)

- 계산한 위치에서 가장 **가까운** 원시 픽셀 값을 **그대로 가져오는 방식**

- 처리 속도가 **가장 빠르지만** 출력 결과물의 **품질이 좋지 않음**

- [그림 6] NNI (Nearest Neighbor Interpolation)

    ![image-6.png](/assets/img/opencv/2_opencv22_files/image-6.png)

    1. 원본 영상 혹은 이미지를(2x2) 4x4 크기로 확대시키면 <u>확대한 공간만큼 빈공간 생성</u>
        - 이 **공간을 어떤 방식으로 채우는지가 확대된 이미지의 품질을 결정!**
    2. 기존 픽셀은 유지되지만, 확대 후 생기는 넓어진 공간은 비어있으므로 <u>가장 가까운 픽셀의 값을 가져오는 보간법</u>

- [그림 7] NNI 계산 방식

    ![image-7.png](/assets/img/opencv/2_opencv22_files/image-7.png)

    - 확대된 좌표에서 거리 계산을 통해 가장 가까운 원본 픽셀값을 선택해 그대로 복사
    - 그에따른 결과가 들쭉날쭉한 계단 형태로 나타나 실제 4배 확대시 이미지 품질 저하가 생기는 것을 확인

#### 영상 보간법 (2) : Neighbor Average Interpolation (NAI)

- 이웃 픽셀들의 평균 계산 (2차원의 경우 4개의 이웃 사용)

- 최근접 이웃 보간법(NNI) 에 비해서 연산량이 많지만 조금 더 만족스러운 출력 결과물 제공

- [그림 8] NAI

    ![image-8.png](/assets/img/opencv/2_opencv22_files/image-8.png)

#### 영상 보간법 (3) : Bilinear Interpolation (BI)

- 주변 4개 픽셀의 값을 거리 기반 가중치로 결합

- 연산속도 적당하며, 결과도 만족스러운 출력 결과 제공 -> 가장 널리 사용되는 방식

- [그림 9] BI

    ![image-9.png](/assets/img/opencv/2_opencv22_files/image-9.png)

    - 이미지 확대시, 새로 생기는 픽셀에 대해 위치 밝기(intensity) 를 구하기 위해서 <u>네 개의 가장 가까운 픽셀들에 가중치를 곱한 값들의 합을 사용</u>

    - 새로 생긴 픽셀 주변 픽셀 4개 값 : 
        1. x1, y1 = (9, 9) 에 대한 밝기 50
        2. x2, y1 = (10, 9) 에 대한 밝기 55
        3. x1, y2 = (9, 10) 에 대한 밝기 44
        4. x2, y2 = (10, 10) 에 대한 밝기 48
        ------------------------------------
        - Q: 새 픽셀 좌표 x_hat, y_hat = (9.8, 9.2) 에서의 밝기는?
        - A: 
            1. 주변 픽셀 사이와의 거리를 계산한다
                - y_hat 에서의 y1, y2 거리 차 >> 0.2 / 0.8
                - x_hat 에서 x1, x2 거리 차 >> 0.8 / 0.2

            2. ***가까운수록 높은 가중치, 멀수록 낮은 가중치***(=밝기) 를 부여해 거리와 곱한다
                - y_hat 까지의 가중치
                    - y1 : 50 * 0.8
                    - y2 : 44 * 0.2

                - x_hat 까지의 가중치
                    - x1 : 55 * 0.8
                    - x2 : 50 * 0.2
                
            3. 가중치를 곱한 값들을 모두 더해 최종 필셀 밝기를 갖는다
                - (x_hat, y_hat) = (53.6, 48.8)

                > 최종 픽셀 밝기 = 48.8*0.2 + 53.6 * 0.8 = 52.64 ~= 53
        -----------------------------------
        
    - 즉, ***bilinear 보간법인 이유*** : x축과 y축 양방향으로 선형 보간을 두 번 적용하여 가까운 네 픽셀의 정보를 자연스럽게 섞어주는 방법이라서
        
#### 영상 보간법 (4) : Cubic Interpolation

> BI(3) 가 네 개의 가장 가까운 픽셀들에 가중치를 곱한 값들의 합을 사용하였다면, Cubic Interploation 은 ***그 네개의 픽셀의 주변 정보 픽셀*** (총 8 개 이상) 에 가중치를 곱한 값을 사용한다

> 품질은 가장 좋지만 연산량이 많고, Linear(bilinear) 와 성능이 많이 차이나지 않아 BI 를 더 많이 사용한다

 
### 전단 변환 (Skew, Shearing) 

> 이미지를 특정 방향으로 비틀어 기울이는 변환

![image-5.png](/assets/img/opencv/2_opencv22_files/image-5.png)

- 예시 이미지 : 
    
    ![스크린샷 2025-11-25 142340.png](/assets/img/opencv/2_opencv22_files/스크린샷%202025-11-25%20142340.png)

---

## Perspective Transform : ***비선형 변환***

> Affine 변환이 선형 기반이라면, Perspective 변환은 비선형(Non-linear transform) 방식

- 픽셀별 이동량이 달라질 수 있고

- 고무판처럼 이미지를 임의로 구부리는 효과를 만들 수 있다

- **다항식의 고차항을 포함한 형태**

![스크린샷 2025-11-25 105334.png](/assets/img/opencv/2_opencv22_files/스크린샷%202025-11-25%20105334.png)

- ***왜 '고차항 변환'이라고 부르나?***
    - 🛎️ 비선형 변환이 왜 고차항 변환이라 하냐면?
        1. Affine Transform의 변환 매트릭스는 6개의 항을 가진다.
(2×3 행렬)
            - `[[a, b, c], [d, e, f]]` : 6 항 중에서 몇개를 수정하면 그에 따라서 다른 변환이 이루어지고 했음

            ![스크린샷 2025-11-25 145950.png](/assets/img/opencv/2_opencv22_files/스크린샷%202025-11-25%20145950.png)

        2. Perspective Transform은 8개의 항을 가진다.
(3×3 행렬 중 마지막 항은 1로 고정이라 카운트 x)
            - `[[a, b, c], [d, e, f], [g, h, 1]]` 

            ![스크린샷 2025-11-25 145648.png](/assets/img/opencv/2_opencv22_files/스크린샷%202025-11-25%20145648.png)

            - 항의 수가 늘어날수록 연산은 복잡해지지만, 자유도가 높아져서 Affine 변환(선형변환) 은 하지 못하는 변환이 가능하다


