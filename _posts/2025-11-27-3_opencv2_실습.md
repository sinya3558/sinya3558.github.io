---
title: "OpenCV (3) : ê°ì²´ ê²€ì¶œ â€” ì˜ìƒ ì²˜ë¦¬ ì¢…í•© ì‹¤ìŠµ"
description: "ì—°ê²° ê°ì²´ ê²€ì¶œ(Labeling), ì™¸ê³½ì„  ê²€ì¶œ(Contour), Hu's Moments ê¸°ë°˜ ê°ì²´ ë§¤ì¹­, ë°°ê²½ ì°¨ë¶„ ë° ì´ë™ í‰ê·  ë°°ê²½ ëª¨ë¸ë§, ë™ì˜ìƒ ê°ì²´ ì¶”ì ê¹Œì§€ OpenCV ê°ì²´ ê²€ì¶œì˜ í™•ì¥ ê¸°ë²•ì„ ì‹¤ìŠµí•œ Part.3"
author: Seunga Kim
date: 2025-11-27
categories: [Computer Vision, OpenCV]
tag: [Connected Components, Contour Detection, Hu Moments, Background Subtraction, Video Processing]
toc: true
toc_label: "Table of Contents"
author_profile: true
comments: false
---

# 23. Opencv ë¥¼ ì´ìš©í•œ ë™ì˜ìƒ ì²˜ë¦¬ ì‹¤ìŠµ Part.2


## ë ˆì´ë¸”ë§ (Labeling)

> ì™„ì „ ì—°ê²° í”½ì…€ ê·¸ë£¹(connected components) ì„ ê°ì§€í•˜ê³  ë ˆì´ë¸”ì„ ë¶€ì—¬í•˜ëŠ” ëª©ì ìœ¼ë¡œ ì‚¬ìš©

#### ë ˆì´ë¸”ë§ ì§„í–‰ ìˆœì„œ ìš”ì•½

1. ì»¬ëŸ¬ ì´ë¯¸ì§€ë¥¼ ê·¸ë ˆì´ìŠ¤ì¼€ì¼ë¡œ ë³€í™˜

2. `threshold()` ë¥¼ ì‚¬ìš©í•´ ì´ì§„í™”(Binarization) ì§„í–‰

3. í•„ìš” ì‹œ THRESH_BINARY ì ìš©í•´ ê°ì²´ê°€ í°ìƒ‰(255)ì´ ë˜ë„ë¡ ìƒ‰ìƒ ë°˜ì „
    - `cv2.THRESH_BINARY` : thrsh ë¯¸ë§Œì€ 0ìœ¼ë¡œ, thresh ~ maxval ì´í•˜ëŠ” 1 (=255) ë¡œ ë³€í™˜í•˜ë¼

    - `cv2.THRESH_BINARY_INV` : 0ë¶€í„° thresh ë¯¸ë§Œì„ 1 (=255) ë¡œ, thresh  maxval êµ¬ê°„ì˜ ê°’ì„ 0 ìœ¼ë¡œ ë³€í™˜í•˜ë¼


4. `connectedComponentsWithStats()` í˜¸ì¶œ
    - ê°ì²´ ê°œìˆ˜(cnts)

    - ë ˆì´ë¸” ë§µ(labels)

    - ë°”ìš´ë”© ë°•ìŠ¤ ë° ë©´ì  ì •ë³´(stats)

    - ì¤‘ì‹¬ì (centroids)
    ë“±ì„ í•œ ë²ˆì— ì–»ëŠ”ë‹¤.


##### ì‚¬ìš©í•¨ìˆ˜

```python
connectedComponentsWithStatus(image[, labels[, states[, centrolds[, connectivity[, ltype]]]]]) -> ret_val, labels, stats, centrold
```

### Labeling : ì—°ê²°ëœ ê°ì²´ ê°ì§€ (Connected Components) 1

##### ì‚¬ìš© ì˜ˆì‹œ
`cnts, labels, stats, centroids = cv2.connectedComponentsWithStats(mask)`

1. cnts : ê²€ì¶œëœ ê°ì²´ê°€ ëª‡ ê°œì¸ì§€
    - 0ë²ˆ ì¸ë±ìŠ¤ëŠ” **ì „ì²´ ì´ë¯¸ì§€ ì˜ì—­(ë°°ê²½)** ì´ë¯€ë¡œ ***ê²€ì¶œì—ì„œ ì œì™¸*** í•œë‹¤
        - cnts[0] ì€ ì œì™¸ 
    - cnts[1] ë¶€í„°~

2. labels : ë¼ë²¨ ì •ë³´

3. stats : ê²€ì¶œëœ ê°ì²´ì˜ ì •ë³´

    - `stats[i]` êµ¬ì¡°

        - ***x, y*** : ì¢Œì¸¡ ìƒë‹¨ ì¢Œí‘œ

        - ***w, h*** : ë„ˆë¹„, ë†’ì´

        - ***area*** : ê°ì²´ì˜ í”½ì…€ ê°œìˆ˜(í¬ê¸°)

            - ê²€ì¶œëœ ê°ì²´ê°€ ë„ˆë¬´ ì‘ì•„ ì¡ìŒ ë˜ëŠ” ì„±ëŠ¥ì´ ë‚®ì•„ì§ˆ ìˆ˜ ìˆìœ¼ë¯€ë¡œ
                `if area < 50:` ì²˜ëŸ¼ ***ì˜ì—­(area) í¬ê¸° í•„í„°ë§ í•„ìˆ˜***

4. centroids : ë¬¼ì²´ì˜ ì¤‘ì‹¬ê°’


```python
src = cv2.imread(Path(folder, "rice.jpg"))

# ì´ì§„(binary) ì˜ìƒì—ì„œ ì—°ê²°ì„±ë¶„ì„ ì¶”ì¶œí•˜ê³  ë¼ë²¨ë§ ì§„í–‰ -> í‘ë°±
src_gray = cv2.cvtColor(src, cv2.COLOR_BGR2GRAY)

# ìƒ‰ìƒë°˜ì „
_, mask = cv2.threshold(src_gray, 100, 255, cv2.THRESH_BINARY_INV)  # ê²€ì¶œí•˜ê³ ìí•˜ëŠ” ê°ì²´ê°€ ê²€ì€ìƒ‰, ê·¸ ì™¸ê°€ í•˜ì–€ìƒ‰ì´ë¼ì„œ ìƒ‰ìƒ ë°˜ì „ì˜ ë°˜ì „ì„ í•¨

cv2.imshow("src", src)
cv2.imshow("grayscale src", src_gray)
cv2.imshow("mask", mask)

while True:
    if cv2.waitKey() == ord("q"):
        break

cv2.destroyAllWindows()
```

#### ê²°ê³¼ ë¹„êµ

- source / grayscale / color inversion

![image.png](/assets/img/opencv/3_opencv2_ì‹¤ìŠµ_files/ìŠ¤í¬ë¦°ìƒ·%202025-11-26%20102606.png)


```python
cnts, labels, stats, centroids = cv2.connectedComponentsWithStats(mask)

print("counts = ", cnts, "labels shape = ", labels.shape)
print("stats (ìš°ë¦¬ê°€ ì‚¬ìš©í•  ê±°) = ", stats, "\nstats[0] = ", stats[0])

for i in range(1, cnts):    # 0 ë²ˆì€ ì´ë¯¸ì§€ ì „ì²´ì— ëŒ€í•œ background ë¼ì„œ ê°€ì ¸ì˜¤ì§€ x 
    x, y, w, h, area = stats[i] # ë°”ìš´ë”© ë°•ìŠ¤ ì§€ì •
    if area < 50 :              # ë§Œì•½ area ê°€ ë„ˆë¬´ ì‘ìœ¼ë©´ ë„˜ê¸°ê¸°
        continue
    # 50 ì´ìƒì´ë¼ë©´, 
    cv2.rectangle(src, (x, y, w, h), (0, 0, 225), 2)    # ë¹¨ê°„ìƒ‰ bbox êµµê¸° 2

cv2.imshow("src", src)
cv2.imshow("mask", mask)

while True:
    if cv2.waitKey() == ord("q"):
        break

cv2.destroyAllWindows()
```

    counts =  386 labels shape =  (427, 640)
    stats (ìš°ë¦¬ê°€ ì‚¬ìš©í•  ê±°) =  [[     0      0    640    427 233399]
     [    20      0     16     18    128]
     [    53      0     10      8     31]
     ...
     [   152    421      1      1      1]
     [   247    421     22      6     85]
     [   147    423      4      4      9]] 
    stats[0] =  [     0      0    640    427 233399]
    

#### ê²°ê³¼ í™•ì¸

- src / mask

![image.png](/assets/img/opencv/3_opencv2_ì‹¤ìŠµ_files/ìŠ¤í¬ë¦°ìƒ·%202025-11-26%20104129.png)

- ê°ì²´ ê°ì§€ ì„±ê³µ

### ê°ì²´ íƒì§€ëœ ë°”ìš´ë”© ë°•ìŠ¤ ìœ„ì— ì¸ë±ìŠ¤ ì“°ê¸°

- ë„˜ë²„ë§ì´ ì–´ë–»ê²Œ ì§„í–‰ë˜ëŠ”ì§€ í™•ì¸ìš©
- ì €ì¥ì€ í•  ìˆ˜ ì—†ìŒ


```python
for i in range(1, cnts):    # 0 ë²ˆì€ ì´ë¯¸ì§€ ì „ì²´ì— ëŒ€í•œ background ë¼ì„œ ê°€ì ¸ì˜¤ì§€ x 
    x, y, w, h, area = stats[i] # ë°”ìš´ë”© ë°•ìŠ¤ ì§€ì •
    if area < 50 :              # ë§Œì•½ area ê°€ ë„ˆë¬´ ì‘ìœ¼ë©´ ë„˜ê¸°ê¸°
        continue
    # 50 ì´ìƒì´ë¼ë©´, 
    cv2.rectangle(src, (x, y, w, h), (0, 0, 225), 2)    # ë¹¨ê°„ìƒ‰ bbox êµµê¸° 2
    cv2.putText(src, str(i), (x, y), cv2.FONT_HERSHEY_PLAIN, 1, (0, 0, 225), 1, cv2.LINE_AA)

cv2.imshow("src", src)

while True:
    if cv2.waitKey() == ord("q"):
        break

cv2.destroyAllWindows()
```

#### ê²°ê³¼ í™•ì¸

![image.png](/assets/img/opencv/3_opencv2_ì‹¤ìŠµ_files/ìŠ¤í¬ë¦°ìƒ·%202025-11-26%20104651.png)

---

### Labeling: ì—°ê²°ëœ ê°ì²´ ê²€ì¶œ 2

- ìƒˆë¡œìš´ ì´ë¯¸ì§€ë¡œ ë‹¤ì‹œ í•œ ë²ˆ í•´ë´¤ë‹¤
    - ëª¨ë“  ì´ë¯¸ì§€ë“¤ì˜ ì¶œì²˜ : Pixabay


```python
src = cv2.imread(Path(folder, "symbols.jpg"))

# ì´ì§„(binary) ì˜ìƒì—ì„œ ì—°ê²°ì„±ë¶„ì„ ì¶”ì¶œí•˜ê³  ë¼ë²¨ë§ ì§„í–‰ -> í‘ë°±
src_gray = cv2.cvtColor(src, cv2.COLOR_BGR2GRAY)

# ìƒ‰ìƒë°˜ì „
_, mask = cv2.threshold(src_gray, 100, 255, cv2.THRESH_BINARY_INV)  # 

# ë ˆì´ë¸”ë§ ê°ì²´ ê²€ì¶œ
cnts, labels, stats, centroids = cv2.connectedComponentsWithStats(mask)

for i in range(1, cnts):  
    x, y, w, h, area = stats[i] # ë°”ìš´ë”© ë°•ìŠ¤ ì§€ì •
    if area < 50 :              # ë§Œì•½ area ê°€ ë„ˆë¬´ ì‘ìœ¼ë©´ ë„˜ê¸°ê¸° : binary object detection
        continue
    # 50 ì´ìƒì´ë¼ë©´, 
    cv2.rectangle(src, (x, y, w, h), (255, 0, 0), 2)    # íŒŒë€ìƒ‰ bbox êµµê¸° 2
    cv2.putText(src, str(i), (x, y), cv2.FONT_HERSHEY_PLAIN, 1, (255, 0, 0), 1, cv2.LINE_AA)


cv2.imshow("src", src)
cv2.imshow("grayscale src", src_gray)
cv2.imshow("mask", mask)

while True:
    if cv2.waitKey() == ord("q"):
        break

cv2.destroyAllWindows()
```

#### ê²°ê³¼ í™•ì¸

- gray / mask / src (detect objects)

![image.png](/assets/img/opencv/3_opencv2_ì‹¤ìŠµ_files/ìŠ¤í¬ë¦°ìƒ·%202025-11-26%20105824.png)


---

## ì™¸ê³½ì„  ê²€ì¶œ (Contour Detection)

> ì™¸ê³½ì„ (contour)ì€ ê°ì²´ì˜ ê²½ê³„ë¥¼ ì´ë£¨ëŠ” ì¢Œí‘œë“¤ì˜ ì§‘í•©ì´ë‹¤. ì´ë¥¼ ì–»ê¸° ìœ„í•´ì„œëŠ” ë°˜ë“œì‹œ **ì´ì§„ ë§ˆìŠ¤í¬(binary mask)** ê°€ í•„ìš”í•˜ë‹¤ >> binary image ë³€í™˜ ë˜í•œ í•„ìˆ˜ë‹¤

### ì™¸ê³½ì„  ê²€ì¶œ ìˆœì„œ

1. ì´ì§„ë²• ì´ë¯¸ì§€ ìƒì„±ì„ ìœ„í•œ grayscale ë³€í™˜ëœ **ì´ë¯¸ì§€ë¥¼ ìƒì„±**. (ì›ë³¸ì´ë¯¸ì§€ì— ë®ì–´ ì”Œìš°ëŠ” ê±° ì•„ë‹˜. ì›ë³¸ì— ê²€ì¶œ ê²°ê³¼ë¥¼ í‘œì‹œí•´ì•¼í•˜ê¸° ë•Œë¬¸ì— ì›ë³¸ì€ ë”°ë¡œ ë³´ì¡´í•˜ê³  ë³„ë„ì˜ *ë³µì‚¬ë³¸ ìƒì„±*)

2. threshold ì´ìš©í•´ì„œ ì´ì§„í™” ì§„í–‰ í›„ â†’ mask ì–»ê¸°

    - ê°€ëŠ¥í•œ ì˜µì…˜ 
        - (1) : `cv2.THRESH_BINARY_INV`
        - (2) : `cv2.THRESH_BINARY`

3. ì™¸ê³½ì„  ë”°ê¸° â†’ `findContours()` ë¡œ ì™¸ê³½ì„  ì¢Œí‘œ ì¶”ì¶œ

    - ***contours*** : ì™¸ê³½ì„  ì¢Œí‘œ

    - ***method*** : ì™¸ê³½ì„  ê·¼ì‚¬í™” ë°©ë²•

        - `CHAIN_APPROX_NONE` : ëª¨ë“  ì  ì €ì¥ => ê·¼ì‚¬í•˜ì§€ ì•Šê² ë‹¤

        - `CHAIN_APPROX_SIMPLE` : ê¼­ì§“ì ë§Œ ì €ì¥

     - ***mode (RETR_..)*** : ì™¸ê³½ì„  ê²€ì¶œ ëª¨ë“œ

        ![image_hierarchy](/assets/img/opencv/3_opencv2_ì‹¤ìŠµ_files/ìŠ¤í¬ë¦°ìƒ·%202025-11-26%20111704.png)
        
        - ê³„*ì¸µì •ë³´(hierarchy) ì¡´ì¬ x*
            - `RETR_EXTERNAL` : ê°€ì¥ ë°”ê¹¥ ì™¸ê³½ì„ ë§Œ

            - `RETR_LIST` : ëª¨ë“  ì™¸ê³½ì„  ì¶”ì¶œ

        - *ê³„ì¸µì •ë³´(hierarchy) ì¡´ì¬ o*
            - `cv2.RETR_CCOMP`
            - `cv2.RETR_TREE`

4. drawContours() ë¥¼ ì´ìš©í•´ ì‹œê°í™”


```python
findContours(image, mode, method[, contours[, hierarchy[, offset]]]) -> contours, hierarchy
# image : ì¸í’‹ ì˜ìƒ, non-zero í”½ì…€ì„ ê°ì²´ë¡œ ê°„ì£¼í•¨
# mode: ì™¸ê³½ì„  ê²€ì¶œ ëª¨ë“œ, cv2_RETR_ ë¡œ ì‹œì‘í•˜ëŠ” ìƒìˆ˜
    '''
    cv2.RETR_EXTERNAL,
    cv2.RETR_LIST,
    cv2.RETR_CCOMP,
    cv2.RETR_TREE
    '''
# method : ì™¸ê³½ì„  ê·¼ì‚¬í™” ë°©ë²•, cv2.CHAIN_APPROX_ ë¡œ ì‹œì‘í•˜ëŠ” ìƒìˆ˜
# contour : ê²€ì¶œëœ ì™¸ê³½ì„  ì¢Œí‘œ, numpy.ndarray ë¡œ êµ¬ì„±ëœ ë¦¬ìŠ¤íŠ¸
# countours[i].shape=(k, 1, 2), contours[i].dtype= numpy.int32
# hierarchy: ì™¸ê³½ì„  ê³„ì¸µ ì •ë³´, numpy.ndarray.shape = (1, N, 4), dtype= numpy.int32
# ì™¸ê³½ì„  ì¸ë±ìŠ¤ë¥¼ ê°€ë¦¬í‚´. í•´ë‹¹ ì™¸ê³½ì„ ì´ ì—†ìœ¼ë©´ -1
# offset : ì¢Œí‘œ ê°’ ì´ë™ ì˜¤í”„ì…‹. ê¸°ë³¸ê°’ì€ (0, 0)

drawContours(image, contours, contourIdx, color[, thickness[, lineType[, hierarchy[, maxLevel[, offset]]]]]) -> image
```

### ì™¸ê³½ì„  ê²€ì¶œ

```python
src = cv2.imread(Path(folder, "spades.jpg"))

# 1. grayscale
src_gray = cv2.cvtColor(src, cv2.COLOR_BGR2GRAY)
# 2. ì´ì§„í™” í•´ì„œ ë§ˆìŠ¤í¬ ì–»ê¸°
_, mask = cv2.threshold(src_gray, 150, 255, cv2.THRESH_BINARY_INV)
# 3. ì™¸ê³½ì„  ê²€ì¶œ í•¨ìˆ˜ ì‚¬ìš©
contours, hierachy = cv2.findContours(mask, cv2.RETR_LIST, cv2.CHAIN_APPROX_NONE)
# í™•ì¸
# print("contour length = ", len(contours))   # ë¬¼ì²´ì— ëŒ€í•œ ì™¸ê³½ì„ ì˜ ê°œìˆ˜
# print("contour shape = ", contours[0].shape) # ì™¸ê³½ì„ ì˜ í¬ì§€ì…˜ # (242, 1, 2)

cv2.imshow("src", src)
cv2.imshow("gray", src_gray)
cv2.imshow("mask", mask)


while True:
    if cv2.waitKey() == ord("q"):
        break

cv2.destroyAllWindows()
```


```python
# ì¢Œí‘œê°’
print(contours[0][0][0])
# [216, 492] == x, y
print(contours[1][0][0])   
# [122 491]
```

    [502 270]
    [374 134]
    

#### ê²°ê³¼ í™•ì¸

- original / grayscale / mask

![image-2.png](/assets/img/opencv/3_opencv2_ì‹¤ìŠµ_files/ìŠ¤í¬ë¦°ìƒ·%202025-11-26%20121113.png)


### ì™¸ê³½ì„  ê²€ì¶œ ì‹œê°í™”

```python
for i in range(len(contours)):
    cv2.drawContours(src, contours, i, (0, 0, 255), 2)
    cv2.putText(src, str(i), contours[i][0][0], cv2.FONT_HERSHEY_PLAIN, 1.5, (0, 0, 255), 2, cv2.LINE_AA)

cv2.imshow("src", src)
cv2.imshow("gray", src_gray)

while True:
    if cv2.waitKey() == ord("q"):
        break

cv2.destroyAllWindows()
```

#### ê²°ê³¼ ë¹„êµ

- src(ì™¸ê³½ì„  ê²€ì¶œ) / grayscale

![image.png](/assets/img/opencv/3_opencv2_ì‹¤ìŠµ_files/ìŠ¤í¬ë¦°ìƒ·%202025-11-26%20121234.png)


## ëª¨ë©˜íŠ¸ ê¸°ë°˜ ê°ì²´ ê²€ì¶œ (Shape Matching)

> íƒ€ê²Ÿ ê°ì²´ì˜ ì™¸ê³½ì„ ê³¼ ì…ë ¥ ì´ë¯¸ì§€ì˜ ì™¸ê³½ì„ ì„ ë¹„êµí•˜ì—¬ ê°€ì¥ ìœ ì‚¬í•œ í˜•íƒœë¥¼ ì°¾ëŠ” ë°©ì‹

- ë¹„êµ ëŒ€ìƒì€ ì™¸ê³½ì„ (contour)

- cv2.matchShapes() ë¥¼ ì‚¬ìš©í•´ shape distance ê³„ì‚°

    - ê²°ê³¼ê°’ì´ 0 ì— ê°€ê¹Œìš¸ìˆ˜ë¡ ë‘ ê°ì²´ëŠ” ìœ ì‚¬í•˜ë‹¤ : difference(ì°¨ì´) ë¡œ í‘œí˜„í•˜ê¸° ë•Œë¬¸ì—, ì ì„ìˆ˜ë¡ ìœ ì‚¬í•œ ê°ì²´ë¼ëŠ” ëœ»ì´ë‹¤

- Hu Moments ê¸°ë°˜ìœ¼ë¡œ íšŒì „Â·ìŠ¤ì¼€ì¼ ë³€í™”ì—ë„ ê°•í•¨


### í•µì‹¬ í¬ì¸íŠ¸
- ***ë§ˆìŠ¤í¬ ìƒì„±***
    - ë°˜ë“œì‹œ ì´ì§„í™” ì²˜ë¦¬ í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— Grayscale í•„ìˆ˜
        1. `cv2.COLOR_BGR2GRAY` : ìê¾¸ í—·ê°ˆë¦¬ì§€ë§Œ ì´ê±° ì•„ë‹˜
        2. `cv2.IMREAD_GRAYSCALE` : ì´ê±°ì„!!

- íƒ€ê²Ÿ ì™¸ê³½ì„ (obj_contours[0])ê³¼ ëª¨ë“  src ì™¸ê³½ì„  ë¹„êµ

- `if dist < 0.1:` ì²˜ëŸ¼ thresholdë¥¼ ì •í•´ ë™ì¼ ê°ì²´ë¡œ íŒë‹¨

```python
cv2.contourArea(src_contours[0])    # ì™¸ê³½ì„ ì— ë‘˜ëŸ¬ì‹¸ì—¬ì‡ëŠ” ì˜ì—­ì´ ê²°ê³¼ë¡œ ë‚˜ì˜´
cv2.boundingRect(src_contours[0])   # BBOX ì¢Œí‘œ
```


```python
obj = cv2.imread(Path(folder, "four_symbols.jpg"), cv2.IMREAD_GRAYSCALE)  
src = cv2.imread(Path(folder, "symbol_collection.jpg"), cv2.IMREAD_GRAYSCALE)


_, obj_binary = cv2.threshold(obj, 100, 255, cv2.THRESH_BINARY_INV)
_, src_binary = cv2.threshold(src, 100, 255, cv2.THRESH_BINARY_INV)

cv2.imshow("original object", obj)
cv2.imshow("src", src)
cv2.imshow("object binary", obj_binary)
cv2.imshow("src binary", src_binary)

while True:
    if cv2.waitKey() == ord("q"):
        break

cv2.destroyAllWindows()

```

#### ê²°ê³¼ í™•ì¸

- íƒ€ê²Ÿ ì´ë¯¸ì§€ (object) / ìœ ì‚¬í•œ ê°ì²´ë¥¼ íƒì§€í•  ì´ë¯¸ì§€ (src)

![ìŠ¤í¬ë¦°ìƒ· 2025-11-26 141106.png](/assets/img/opencv/3_opencv2_ì‹¤ìŠµ_files/ìŠ¤í¬ë¦°ìƒ·%202025-11-26%20141106.png)

- **object** / **binary object**(ìƒ‰ìƒë³€í™˜) / **src** / **binary src**(ìƒ‰ìƒë³€í™˜)

- COLORSCALE (ê¹œë°•í•˜ê³  ì»¬ëŸ¬ë¡œ ì§„í–‰)

    ![ìŠ¤í¬ë¦°ìƒ· 2025-11-26 141123.png](/assets/img/opencv/3_opencv2_ì‹¤ìŠµ_files/ìŠ¤í¬ë¦°ìƒ·%202025-11-26%20141123.png)

- GRAYSCLAE (ì´ì§„í™” í•˜ê¸° ìœ„í•´ì„œ)

    ![image.png](/assets/img/opencv/3_opencv2_ì‹¤ìŠµ_files/ìŠ¤í¬ë¦°ìƒ·%202025-11-26%20141726.png)


```python
## ì™¸ê³½ì„  ì •ë³´(obj_binary, src_binary) ë½‘ê¸°
obj_contours, _ = cv2.findContours(obj_binary, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_NONE)
src_contours, _ = cv2.findContours(src_binary, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_NONE)

dst = cv2.cvtColor(src, cv2.COLOR_GRAY2BGR)

# ê°ì²´ì˜ ê°œìˆ˜ í™•ì¸
# print("obj contour shape = ", len(obj_contours))
# print("src contour shape = ", len(src_contours))


for pts in src_contours:
    if cv2.contourArea(pts) < 1000:
        continue

    rect = cv2.boundingRect(pts)
    cv2.rectangle(dst, rect, (255, 0, 0), 1)
    dist = cv2.matchShapes(obj_contours[0], pts, cv2.CONTOURS_MATCH_I3, 0)
    # print(f"points = ", pts)
    # print("distance only  = ", dist)
    if dist < 0.1 :
        cv2.rectangle(dst, rect, (0, 0, 255), 2)


cv2.imshow("original object", obj)
cv2.imshow("src", src)
cv2.imshow("dst", dst)
cv2.imshow("object binary", obj_binary)
cv2.imshow("src binary", src_binary)

while True:
    if cv2.waitKey() == ord("q"):
        break

cv2.destroyAllWindows()
```


```python
cv2.contourArea(src_contours[0])    # ì™¸ê³½ì„ ì— ë‘˜ëŸ¬ì‹¸ì—¬ì‡ëŠ” ì˜ì—­ì´ ê²°ê³¼ë¡œ ë‚˜ì˜´
cv2.boundingRect(src_contours[0])   # BBOX ì¢Œí‘œ
```




    (42, 487, 86, 98)



#### ê²°ê³¼ í™•ì¸ : ëª¨ë©˜íŠ¸ ê°ì²´ ê²€ì¶œ

![image.png](/assets/img/opencv/3_opencv2_ì‹¤ìŠµ_files/ìŠ¤í¬ë¦°ìƒ·%202025-11-26%20141830.png)

- ê²€ì¶œëœ ê°ì²´ì˜ ê°œìˆ˜

    1. obj contour shape =  4
    2. src contour shape =  20 -> ì™œ 16ê°œê°€ ì•„ë‹ˆê³  20ê°œ ì¸ì§€ëŠ” ì˜ ëª¨ë¥´ê² ìŒ

#### ìµœì¢… ê²€ì¶œ ì•„ì›ƒí’‹ ìœ„ì— ê°ì²´ì˜ ìœ ì‚¬ì„± ì‹œê°í™”í•˜ê¸°

> ëª¨ë“  ì •ë³´ëŠ” `src_contours` ì—ì„œ ì–»ëŠ”ë‹¤

1. x, y ì •ë³´ êµ¬í•˜ê¸°


```python
src_contours[0].shape   # (253, 1, 2) - (ì™¸ê³½ì„  ì •ë³´, í•„ìš” x, xì™€ y)
```




    (253, 1, 2)



2. ì™¸ê³½ì„ ìœ¼ë¡œ ë‘˜ëŸ¬ì‹¸ì—¬ ìˆëŠ” ì˜ì—­ì˜ í¬ê¸° êµ¬í•˜ê¸°


```python
cv2.contourArea(src_contours[0])    # 5478.5 -> ì™¸ê³½ì„ ì— ë‘˜ëŸ¬ì‹¸ì—¬ ìˆëŠ” ì˜ì—­ì˜ í¬ê¸°
```




    5478.5



3. ë°”ìš´ë”© ë°•ìŠ¤ì˜ ë‘ ê°œì˜ ì¢Œí‘œ êµ¬í•˜ê¸° (ì¢Œì¸¡ìƒë‹¨, ìš°ì¸¡í•˜ë‹¨)
    - (x1, y1, x2, y2)


```python
cv2.boundingRect(src_contours[0])   # (42, 487, 86, 98) -> (x1, y1, x2, y2)
```




    (42, 487, 86, 98)




```python
dst = cv2.cvtColor(src, cv2.COLOR_GRAY2BGR)

for points in src_contours: # 20 ê°œ ì¤‘ì—ì„œ
    if cv2.contourArea(points) < 1000:
        continue

    bbox = cv2.boundingRect(points)
    cv2.rectangle(dst, bbox, (225, 0, 0), 1)
    # calculate distance
    distance = cv2.matchShapes(obj_contours[0], points, cv2.CONTOURS_MATCH_I3, 0)
    # print(distance)

    # text
    cv2.putText(dst, str(round(distance, 4)), (bbox[0], bbox[1] - 4), cv2.FONT_HERSHEY_PLAIN,
                0.8, (225, 0, 0), 1, cv2.LINE_AA)
    
    if distance < 0.1:  # ê³„ì‚°ëœ ê±°ë¦¬ê°€ 0.1 ì´í•˜ë¼ë©´, íƒ€ê²Ÿ ê°ì²´ì™€ ìœ ì‚¬í•  í™•ë¥  ì¦ê°€
        # ë¹¨ê°„ìƒ‰ ë°•ìŠ¤
        cv2.rectangle(dst, bbox, (0, 0, 225), 2)


cv2.imshow("moment objects detection", dst)
cv2.imshow("src", src)
cv2.imshow("target objects", obj)

while True:
    if cv2.waitKey() == ord("q"):
        break

cv2.destroyAllWindows()
```

#### ê²°ê³¼ ë¹„êµ

- íƒ€ê²Ÿ ê°ì²´ / src ì—ì„œ ê²€ì¶œí•œ ê²°ê³¼ / src

![image.png](/assets/img/opencv/3_opencv2_ì‹¤ìŠµ_files/ìŠ¤í¬ë¦°ìƒ·%202025-11-26%20143803.png)

---


## ë™ì˜ìƒ ì²˜ë¦¬

### ë™ì˜ìƒ ì²˜ë¦¬ ê¸°ë³¸ íë¦„

1. cv2 ë¥¼ ì´ìš©í•˜ì—¬ ë™ì˜ìƒ ë˜ëŠ” ì›¹ìº  ì—´ê¸° : `.VideoCapture()`

2. ì˜¬ë°”ë¥´ê²Œ ë™ì˜ìƒì´ ì½íˆëŠ”ì§€ í™•ì¸ : `isOpened()`

3. ë™ì˜ìƒ (ë³´í†µ FPS 30) ì´ê¸°ë•Œë¬¸ì— while loop ìœ¼ë¡œ ***ì—°ì†í•´ì„œ ì½ì–´ì£¼ê¸°***
    - read() ë¥¼ ë°˜ë³µí•˜ë©° í”„ë ˆì„ ì½ê¸°

4. waitKey() ë¡œ ì ì ˆí•œ FPS ì¡°ì ˆ
    - waitKey(0) -> keyboard ì…ë ¥ì´ ìˆì„ ë•Œê¹Œì§€ ë¬´í•œ ëŒ€ê¸°
    - waitKey(30) -> 30 ms

5. ë‹¤ ì½ì€ í›„, ì¢…ë£Œí•´ì£¼ê¸° âœ¨
    - `destroyAllWindows()` + `cap.release()`


```python
cap = cv2.VideoCapture(Path(folder, "parking_lot.mp4"))

# ë™ì˜ìƒì´ ë“¤ì–´ì™”ëŠëƒ? ì¡´ì¬í•˜ëŠëƒ?
cap.isOpened()

# ë§Œì•½ ë¹„ì–´ìˆë‹¤ë©´,
if not cap.isOpened():
    print("Video open failed")
    sys.exit()

ret_val, background = cap.read()

cv2.imshow("Background ", background)   # ë™ì˜ìƒì—ì„œ ë§¨ ì• í”„ë ˆì„ í•œì¥ë§Œ ì½ìŒ > while loop í•„ìš”
cv2.waitKey()
cv2.destroyAllWindows()
```

### While loop ì‚¬ìš©í•˜ì—¬ ì—°ì†ì ìœ¼ë¡œ ì½ê¸°


```python
cap = cv2.VideoCapture(Path(folder, "parking_lot.mp4"))

# ë§Œì•½ ë¹„ì–´ìˆë‹¤ë©´,
if not cap.isOpened():
    print("Video open failed")
    sys.exit()

while True:
    ret_val, frame = cap.read()

    # ì´ë¯¸ì§€ê°€ ì•ˆë“¤ì–´ì˜¤ë©´ -> í”„ë¡œê·¸ë¨ ì¢…ë£Œ
    if not ret_val :
        break

    cv2.imshow("frame", frame)

    if cv2.waitKey(30) == 27:
        break

cv2.destroyAllWindows()
cap.release()

```

#### ë™ì˜ìƒ ì½ê¸° ê²°ê³¼ í™•ì¸

<video width="100%" controls>
  <source src="/assets/video/opencv/parking_lot.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>



## ì°¨ë¶„(Background Subtraction) ê¸°ë°˜ ê°ì²´ ê²€ì¶œ


```python
cap = cv2.VideoCapture(Path(folder, "parking_lot.mp4"))

# ë§Œì•½ ë¹„ì–´ìˆë‹¤ë©´,
if not cap.isOpened():
    print("Video open failed")
    sys.exit()

while True:
    ret_val, frame = cap.read()

    if not ret_val :
        break

    diff = cv2.subtract(frame, background)  # frame(ì»¬ëŸ¬) -  background(ì»¬ëŸ¬)

    cv2.imshow("frame", frame)
    cv2.imshow("diff", diff)

    if cv2.waitKey(30) == 27:
        break

cv2.destroyAllWindows()
cap.release()

```

#### ê²°ê³¼ ë¹„êµ

- color ì˜ìƒ í”„ë ˆì„ - color ë°°ê²½ ë¹¼ì¤€ ê²°ê³¼

![ìŠ¤í¬ë¦°ìƒ· 2025-11-26 153202.png](/assets/img/opencv/3_opencv2_ì‹¤ìŠµ_files/ìŠ¤í¬ë¦°ìƒ·%202025-11-26%20153202.png)

**TO DO**
1. background : color -> gray
2. frame : color -> gray


```python
cap = cv2.VideoCapture(Path(folder, "parking_lot.mp4"))

# ë§Œì•½ ë¹„ì–´ìˆë‹¤ë©´,
if not cap.isOpened():
    print("Video open failed")
    sys.exit()

ret_val, background = cap.read()
background_gray = cv2.cvtColor(background, cv2.COLOR_BGR2GRAY)
cv2.imshow("background(gray)", background_gray)

while True:
    ret_val, frame = cap.read()

    if not ret_val :
        break

    frame_gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)
    diff = cv2.subtract(frame_gray, background_gray)  # frame(í‘ë°±) -  background(í‘ë°±)

    cv2.imshow("frame", frame)
    cv2.imshow("diff", diff)

    if cv2.waitKey(30) == 27:
        break

cv2.destroyAllWindows()
cap.release()

```

#### ê²°ê³¼ ë¹„êµ 

- gray í”„ë ˆì„ ì´ë¯¸ì§€ - gray ë°°ê²½

![ìŠ¤í¬ë¦°ìƒ· 2025-11-26 153356.png](/assets/img/opencv/3_opencv2_ì‹¤ìŠµ_files/ìŠ¤í¬ë¦°ìƒ·%202025-11-26%20153356.png)

## ì°¨ë¶„ ì´ìš©í•˜ê¸° ğŸŒ 

> ì¼ë°˜ subtract ë³´ë‹¤ absdiff ì˜ ì„±ëŠ¥ì´ í›¨ì”¬ ë‚«ë‹¤

1. `absdiff()` : subtract() ë³´ë‹¤ í›¨ì”¬ ì•ˆì •ì ì´ë©° ì¡°ëª… ë³€í™”ë‚˜ ìŒìˆ˜ ê°’ ë¬¸ì œì—ì„œë„ ì•ˆì „
2. Threshold â†’ Binary Mask(ì„ê³„ê°’ ì„¤ì •í•´ì„œ ì ìš©)
    - ìš°ë¦¬ê°€ ì•Œê³ ì‹¶ì€ê±´ ì‹¤ì œ ê°’ì´ ì–¼ë§ˆì´ê³  ì´ê²Œ ì•„ë‹ˆë¼, ê°ì²´ì™€ ë°°ê²½ì„ ì–¼ë§ˆë‚˜ ëª…í™•íˆ ë¶„ë¦¬í•˜ëŠëƒ
    - thresh1, maxval : thresh1 ë¯¸ë§Œ 0 / maxval ì´ìƒ ëª¨ë‘ 255 ì²˜ë¦¬
3. Gaussian Blur
    - ë…¸ì´ì¦ˆ ì²˜ë¦¬ >> ê°€ìš°ì‹œì•ˆ ë¸”ëŸ¬ë§ ì ìš©



```python
cap = cv2.VideoCapture(Path(folder, "parking_lot.mp4"))

# ë§Œì•½ ë¹„ì–´ìˆë‹¤ë©´,
if not cap.isOpened():
    print("Video open failed")
    sys.exit()

ret_val, background = cap.read()
background_gray = cv2.cvtColor(background, cv2.COLOR_BGR2GRAY)
cv2.imshow("background(gray)", background_gray)
background_gray_gaussian = cv2.GaussianBlur(background_gray, (0, 0), 1)

while True:
    ret_val, frame = cap.read()

    if not ret_val :
        break

    frame_gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)
    ##
    frame_gray_gaussian = cv2.GaussianBlur(frame_gray, (0, 0), 1)
    # ì¼ë°˜
    diff = cv2.absdiff(frame_gray, background_gray)  # frame(í‘ë°±) -  background(í‘ë°±)
    _, mask = cv2.threshold(diff, 50, 255, cv2.THRESH_BINARY) 
    # ê°€ìš°ì‹œì•ˆ
    diff_gaussian = cv2.absdiff(frame_gray_gaussian, background_gray_gaussian)
    _, mask_gaussian = cv2.threshold(diff_gaussian, 50, 255, cv2.THRESH_BINARY) 

    cv2.imshow("frame", frame)
    cv2.imshow("diff", diff)
    cv2.imshow("mask", mask)
    cv2.imshow("gauissian mask", mask_gaussian)

    if cv2.waitKey(30) == 27:
        break

cv2.destroyAllWindows()
cap.release()

```


```python
# 1. ì°¨ë¶„ ì„¤ì •
diff = cv2.absdiff(frame_gray, background_gray)

# 2. ì„ê³„ê°’ ì„¤ì • 
_, mask = cv2.threshold(diff, 50, 255, cv2.THRESH_BINARY)    # 50 ë¯¸ë§Œ -> 0, 255 ì´ìƒ -> 255

# 3. ê°€ìš°ì‹œì•ˆ ë¸”ëŸ¬ë§ í•„í„°

## ë°°ê²½ ì²˜ë¦¬ (1)
background_gray_gaussian = cv2.GaussianBlur(background_gray, (0, 0), 1)
## í”„ë ˆì„ ì²˜ë¦¬ (2)
frame_gray_gaussian = cv2.GaussianBlur(frame_gray, (0, 0), 1)
```

#### ê²°ê³¼ ë¹„êµ 

1. ì°¨ë¶„ì„ ì´ìš©í•œ ë™ì˜ìƒ ì²˜ë¦¬
    - absdiff(ì›ë³¸ í”„ë ˆì„, ë°°ê²½)

![image-2.png](/assets/img/opencv/3_opencv2_ì‹¤ìŠµ_files/ìŠ¤í¬ë¦°ìƒ·%202025-11-26%20153908.png)

![image.png](/assets/img/opencv/3_opencv2_ì‹¤ìŠµ_files/ìŠ¤í¬ë¦°ìƒ·%202025-11-26%20153746.png)

- í›¨ì”¬ ì˜ ë³´ì„

2. ì°¨ë¶„ + ì„ê³„ê°’ ì„¤ì •ì„ ì´ìš©í•œ ë™ì˜ìƒ ì²˜ë¦¬

![image-3.png](/assets/img/opencv/3_opencv2_ì‹¤ìŠµ_files/ìŠ¤í¬ë¦°ìƒ·%202025-11-26%20154507.png)

![image-4.png](/assets/img/opencv/3_opencv2_ì‹¤ìŠµ_files/ìŠ¤í¬ë¦°ìƒ·%202025-11-26%20154534.png)

3. ë…¸ì´ì¦ˆ ì²˜ë¦¬ë¥¼ ìœ„í•œ ê°€ìš°ì‹œì•ˆ ë¸”ëŸ¬ë§ í•„í„° ì ìš©

- ì›ë³¸ / ì°¨ë¶„ / ì°¨ë¶„ + ì„ê³„ê°’ / ì°¨ë¶„ + ì„ê³„ê°’ + gaussian

![image-6.png](/assets/img/opencv/3_opencv2_ì‹¤ìŠµ_files/ìŠ¤í¬ë¦°ìƒ·%202025-11-26%20155505.png)

![image-5.png](/assets/img/opencv/3_opencv2_ì‹¤ìŠµ_files/ìŠ¤í¬ë¦°ìƒ·%202025-11-26%20155257.png)

- ê°€ìš°ì‹œì•ˆ ë¸”ëŸ¬ ì²˜ë¦¬í•œ ì˜ìƒì˜ ë…¸ì´ì¦ˆê°€ í›¨ì”¬ ì ë‹¤

---

## Connected Components í™œìš©í•œ ê°ì²´ ì¶”ì 

- ì—°ê²° ê°ì²´ ê²€ì¶œ(connected components) : Labeling ì´ìš©í•˜ë©´ ìƒˆë¡œ ìƒê²¨ë‚œ ê°ì²´ë¥¼ ì¶”ì í•˜ëŠ” íš¨ê³¼ë¥¼ ë‚¼ ìˆ˜ ìˆë‹¤

    1. ì›€ì§ì´ëŠ” ê°ì²´ì˜ ë§ˆìŠ¤í¬ì—ì„œ object ë¥¼ ì¶”ì í•œ ë‹¤ìŒ,
    2. í•´ë‹¹ ì¢Œí‘œë¥¼ ì›ë³¸ ì˜ìƒ í”„ë ˆì„ì— ê·¸ëŒ€ë¡œ bbox ë¡œ ë§¤í•‘í•œë‹¤



```python
cap = cv2.VideoCapture(Path(folder, "parking_lot.mp4"))

# ë§Œì•½ ë¹„ì–´ìˆë‹¤ë©´,
if not cap.isOpened():
    print("Video open failed")
    sys.exit()

ret_val, background = cap.read()
background_gray = cv2.cvtColor(background, cv2.COLOR_BGR2GRAY)
cv2.imshow("background(gray)", background_gray)
background_gray_gaussian = cv2.GaussianBlur(background_gray, (0, 0), 1)

while True:
    ret_val, frame = cap.read()

    if not ret_val :
        break

    frame_gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)
    ##
    frame_gray_gaussian = cv2.GaussianBlur(frame_gray, (0, 0), 1)
    # ì¼ë°˜
    diff = cv2.absdiff(frame_gray, background_gray)  # frame(í‘ë°±) -  background(í‘ë°±)
    _, mask = cv2.threshold(diff, 50, 255, cv2.THRESH_BINARY) 
    # ê°€ìš°ì‹œì•ˆ
    diff_gaussian = cv2.absdiff(frame_gray_gaussian, background_gray_gaussian)
    _, mask_gaussian = cv2.threshold(diff_gaussian, 50, 255, cv2.THRESH_BINARY) 

    ## ì—°ê²° ê°ì²´ ê²€ì¶œ!
    cnts, labels, stats, centroids =  cv2.connectedComponentsWithStats(mask_gaussian)   # (1) mask ì—ì„œ ê°ì²´ ê²€ì¶œ

    for i in range(1, cnts):
        x, y, w, h, area = stats[i] # stats ê°€ ìš°ë¦¬ê°€ ì›í•˜ëŠ” bbox ì¢Œí‘œê°’ì„ ë°˜í™˜í•¨
        ## (+) í° ì˜ì—­ë§Œ ê²€ì¶œí•˜ê¸° ìœ„í•œ íŒ
        if area <= 200:   # ì˜ì—­ì‚¬ì´ì¦ˆê°€ 200 í”½ì…€ ì´í•˜ë¼ë©´ ê·¸ëƒ¥ ë„˜ê²¨ë¼
            continue
        cv2.rectangle(frame, (x, y, w, h), (0, 0, 255), 2 )  # (2) ë§ˆìŠ¤í¬ë¡œ ì–»ì€ ê°ì²´ì˜ ìœ„ì¹˜ë¥¼ ì›ë³¸ ì˜ìƒìœ„ì— bboxë¡œ (ì¢Œí‘œê°€ ë™ì¼í•´ì„œ ê°€ëŠ¥)

    cv2.imshow("frame", frame)
    cv2.imshow("gauissian mask", mask_gaussian)

    if cv2.waitKey(30) == 27:
        break

cv2.destroyAllWindows()
cap.release()

```

#### ê²°ê³¼ í™•ì¸

> ìš°ì™€!

1. mask ì˜ì—­ì—ì„œ ì›€ì§ì´ëŠ” ê°ì²´ë¥¼ ê²€ì¶œ í•œ ë’¤, ë™ì¼í•œ ì¢Œí‘œê°’ì„ ê°€ì§„ ì›ë³¸ ì˜ìƒìœ„ì— ë°”ìš´ë”©ë°•ìŠ¤ë¥¼ ê·¸ë ¤ì¤€ ê²ƒ

![image.png](/assets/img/opencv/3_opencv2_ì‹¤ìŠµ_files/ìŠ¤í¬ë¦°ìƒ·%202025-11-26%20160641.png)

- ë‹¨ì  : ***ë„ˆë¬´ ì‘ì€ ê°ì²´ê¹Œì§€ë„ ì „ë¶€ ê²€ì¶œ***ë˜ì–´ ì–´ë–¤ê±¸ ê°€ë¦¬í‚¤ëŠ”ì§€ ì§ê´€ì ì´ì§€ ì•ŠìŒ
    - í•´ê²° ë°©ì•ˆ : ***ê²€ì¶œëœ ì˜ì—­ (area)*** ì˜ ì‚¬ì´ì¦ˆë¥¼ ì¡°ì ˆí•˜ê¸°
        - `if area <= 200:   # ì˜ì—­ í”½ì…€ ì‚¬ì´ì¦ˆê°€ 200 ì´í•˜ë¼ë©´ ê·¸ëƒ¥ ë„˜ê²¨ë¼`


2. ***í° ì˜ì—­ë§Œ ê²€ì¶œ*** í•˜ëŠ” ì›ë³¸ ë™ì˜ìƒ / ê°€ìš°ì‹œì•ˆ ì²˜ë¦¬í•œ ë§ˆìŠ¤í‚¹ ì˜ìƒ

![image-2.png](/assets/img/opencv/3_opencv2_ì‹¤ìŠµ_files/image-2.png)


---


## ì´ë™ í‰ê·  ê¸°ë°˜ ë°°ê²½ ì°¨ë¶„ (Moving Average)

> ë°°ê²½ì´ ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ì—…ë°ì´íŠ¸ë˜ê¸° ë•Œë¬¸ì— ì˜¤ë˜ ì •ì§€í•´ ìˆë˜ ê°ì²´ëŠ” ì ì°¨ ë°°ê²½ìœ¼ë¡œ í¸ì…ëœë‹¤.

##### ì‚¬ìš© í•¨ìˆ˜

- alpha ë†’ì„ìˆ˜ë¡ ë¹ ë¥´ê²Œ ë°°ê²½ì— ë°˜ì˜ë¨
- ìµœì¢…ì ìœ¼ë¡œ ë³´ì—¬ì¤„ ë•ŒëŠ” ë‹¤ì‹œ uint8 ë¡œ ë³€í™˜

```python
accumulateWeighted(src, dst, alpha, mask) -> dst
# src : ì…ë ¥ ì˜ìƒ
# dst : ì¶œë ¥ ì˜ìƒ (dst ëŠ” ë°˜ë“œì‹œ float32)
# alpha : ì¶•ì ê°€ì¤‘ì¹˜(ìƒˆë¡œìš´ ê°ì²´ì—ê²Œ ì–¼ë§ˆë¥¼ ê³±í•´ì¤„ê±°ëƒ?) 
# mask : ë§ˆìŠ¤í¬ ì˜ìƒ
```


```python
cap = cv2.VideoCapture(Path(folder, "colli.mp4"))

if not cap.isOpened():
    print("Video read failed.")
    sys.exit()

## ì°¨ë¶„
ret_val, bg = cap.read()
# ë°°ê²½ : í‘ë°± ìŠ¤ì¼€ì¼
bg_gray = cv2.cvtColor(bg, cv2.COLOR_BGR2GRAY)
# ë°°ê²½ : gaussian
bg_gray = cv2.GaussianBlur(bg_gray, (0, 0), 1)

# ì´ë¯¸ì§€ ì½ê¸°
while True:
    ret_val, frame = cap.read()

    if not ret_val: 
        break

    # í”„ë ˆì„ : í‘ë°± ìŠ¤ì¼€ì¼
    frame_gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)
    # í”„ë ˆì„ : ê°€ìš°ì‹œì•ˆ ë¸”ëŸ¬
    frame_gray = cv2.GaussianBlur(frame_gray, (0, 0), 1)

    # ì°¨ë¶„
    diff = cv2.absdiff(frame_gray, bg_gray)
    # ì°¨ë¶„ì„ ì´ìš©í•œ ë§ˆìŠ¤í¬ ì˜ìƒ ì¶”ì¶œ
    ret_val, mask = cv2.threshold(diff, 50, 255, cv2.THRESH_BINARY)

    # ê°ì²´ ì¢Œí‘œ ë½‘ê¸°
    cnts, labels, stats, centroids = cv2.connectedComponentsWithStats(mask)

    for i in range(1, cnts):
        x, y, w, h, area = stats[i] # ê²€ì¶œëœ ê°ì²´ì— ëŒ€í•œ ì •ë³´ë“¤ í• ë‹¹

        # ë„ˆë¬´ ì‘ì€ ë¬¼ì²´ëŠ” ê°ì§€í•˜ì§€ ë§ì
        if area <= 300:
            continue
        # ì›ë³¸ë™ì˜ìƒì— bbox ì²˜ë¦¬
        cv2.rectangle(frame, (x, y, w, h), (0, 0, 255), 2)

    # ì‹œê°í™”
    cv2.imshow("frame", frame)
    cv2.imshow("background", bg_gray)
    cv2.imshow("mask", mask)
    
    # ì‹œê°í™” ì¢…ë£Œ ì²˜ë¦¬
    if cv2.waitKey(30) == 27:   # 30ms ì•ˆìª½ìœ¼ë¡œ
        break
cv2.destroyAllWindows()
# cap.release ì•ˆ ì“°ë©´ ë‹¤ìŒë²ˆì— ê·¸ ë™ì˜ìƒ ì‚¬ìš© ëª»í•¨!
cap.release()

cv2.calcOpticalFlowPyrLK()
cv2.line()
```

#### ê²°ê³¼ í™•ì¸

- ê°ì²´ íƒì§€í•œ ì›ë³¸ / ë§ˆìŠ¤í¬

![image.png](/assets/img/opencv/3_opencv2_ì‹¤ìŠµ_files/ìŠ¤í¬ë¦°ìƒ·%202025-11-26%20172329.png)

- ê°ì²´ê°€ ë°°ê²½ìœ¼ë¡œ í¸ì… ë˜ì§€ ì•Šì•˜ë‹¤

## ì´ë™ ë³€ê²½ ë°°ê²½ ì°¨ë¶„ (Moving Avg)

- `accumulateWeighted(src, dst, alpha, mask)` ì‚¬ìš©
    - dst : float ìœ¼ë¡œ ë°”ê¿”ì¤˜ì•¼í•¨!!!!
    - alpha : 0.01 -> 0.001 ë“±, ì›¨ì´íŠ¸ë¥¼ ë¹¨ë¦¬ í‚¤ìš°ë©´ ë°°ê²½ì´ ì—†ë°ì´íŠ¸ ë˜ëŠ” ì†ë„ ë˜í•œ ë¹¨ë¼ì§„ë‹¤


```python
cap = cv2.VideoCapture(Path(folder, "colli.mp4"))

if not cap.isOpened():
    print("Video read failed.")
    sys.exit()

## ì°¨ë¶„
ret_val, bg = cap.read()
bg_gray = cv2.cvtColor(bg, cv2.COLOR_BGR2GRAY)
bg_gray = cv2.GaussianBlur(bg_gray, (0, 0), 1)
# (1) ì˜ìƒì€ float ìœ¼ë¡œ ë°”ê¿”ì¤˜ì•¼í•¨ (ì˜ìƒì€ ì •ìˆ˜ ì—°ì‚°ì´ ì•ˆë¨)
float_bg_gray = bg_gray.astype(np.float32)

while True:
    ret_val, frame = cap.read()

    if not ret_val: 
        break

    frame_gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)
    frame_gray = cv2.GaussianBlur(frame_gray, (0, 0), 1)

    # ë°°ê²½ (background) ì—…ë°ì´íŠ¸ í•´ì£¼ê¸°!
    # cv2.accumulateWeighted(frame_gray, bg_gray, 0.01)
    cv2.accumulateWeighted(frame_gray, float_bg_gray, 0.01)

    # ìœ„ì—ì„œ float ìœ¼ë¡œ ë³€í™˜í–ˆê¸°ë•Œë¬¸ì— ì´ë¯¸ì§€ë¡œ ì‹œê°í™” í•  ìˆ˜ ê°€ x
    # (2) ë‹¤ì‹œ ì´ë¯¸ì§€ë¡œ ë³€ê²½ ã„±ã„± -> uint8
    bg_gray = float_bg_gray.astype(np.uint8)

    diff = cv2.absdiff(frame_gray, bg_gray)
    ret_val, mask = cv2.threshold(diff, 50, 255, cv2.THRESH_BINARY)
    cnts, labels, stats, centroids = cv2.connectedComponentsWithStats(mask)

    for i in range(1, cnts):
        x, y, w, h, area = stats[i]

        if area <= 800:
            continue
        cv2.rectangle(frame, (x, y, w, h), (0, 0, 255), 2)

    # ì‹œê°í™”
    cv2.imshow("frame", frame)
    cv2.imshow("background", bg_gray)
    # cv2.imshow("mask", mask)
    
    if cv2.waitKey(30) == 27: 
        break
cv2.destroyAllWindows()
# cap.release!
cap.release()
```

#### ê²°ê³¼ í™•ì¸

- ì²˜ìŒ ë¶€ë¶„ ë°°ê²½ : 

  ![ìŠ¤í¬ë¦°ìƒ· 2025-11-26 175742.png](/assets/img/opencv/3_opencv2_ì‹¤ìŠµ_files/ìŠ¤í¬ë¦°ìƒ·%202025-11-26%20175742.png)

- ë‚˜ì¤‘ ë¶€ë¶„ ë°°ê²½ ì—…ë°ì´íŠ¸ : 
  
  ![image.png](/assets/img/opencv/3_opencv2_ì‹¤ìŠµ_files/ìŠ¤í¬ë¦°ìƒ·%202025-11-26%20175810.png)

<video controls style="width: 100%; height: auto;">
  <source src="/assets/video/opencv/movingavg.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>

- ë°°ê²½ì„ ìì„¸íˆ ë“¤ì—¬ë‹¤ ë³´ë©´, frame ì—ì„œ ì˜¤ë˜ë„ë¡ ë©ˆì¶°ìˆëŠ” ê°•ì•„ì§€ì˜ í˜•ì²´ê°€ ë°°ê²½ìœ¼ë¡œ í¸ì…ë˜ëŠ”ê²ƒì„ í™•ì¼ í•  ìˆ˜ ìˆë‹¤!

---

