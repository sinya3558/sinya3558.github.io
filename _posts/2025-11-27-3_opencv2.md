---
title: "OpenCV (4) : 동영상 처리 & 객체 추적"
description: "연결 객체, 외곽선, Hu 불변 모멘트, 배경 차분·이동평균 기반 배경 모델링 기법들 정리한 OpenCV Part.3"
author: Seunga Kim
date: 2025-11-27
categories: [Computer Vision, OpenCV]
tag: [Video Processing, Connected Components, Contour Detection, Hu Moments, Background Subtraction]
image: /assets/img/space-invaders.png
toc: true
toc_label: "Table of Contents"
author_profile: true
comments: false
---

##### 📚 Reference: 
- 🔗 두산 로키 5기 강의자료


# 23. OpenCV 를 이용한 동영상 처리 (3) Part.2

> 주제 : (1) **단일 영상 내 객체 검출의 원리를 이해**하고, (2) **이를 동영상 스트림에서 실시간으로 객체를 검출**하는 방법을 학습한다

### 세부 내용

1. ~~전진 차분, 후진 차분, 중앙 차분 (차분 == 미분)~~ (Part.1)

2. ~~소벨 (Sobel) 필터를 이용한 영상 에지 검출~~ (Part.1)

3. ~~Canny edge 를 이용한 영상 에지 검출~~ (Part.1)

4. ~~Hough transform 을 이용한 영상 직선 및 원 검출~~ (Part.1)

5. 연결객체검출과 외곽선 검츨

6. Hu’s Invariant Moments 를 이용한 객체 검출

7. 배경 차분과 이동평균 배경 차분

8. Webcam 을 통한 실시간 동영상 다루기

---

## OpenCV Bitwise : 비트 연산

> 마스크(mask)를 이용한 특정 영역 강조, 객체 제거 등에 자주 활용된다

![스크린샷 2025-11-26 094359.png](/assets/img/opencv/3_opencv2_files/스크린샷%202025-11-26%20094359.png)

1. 부정 (**NOT**) : 단일 입력 비트값을 반전시킨다. 0 ↔ 1 반전  
2. 논리곱 (**AND**) : 두 입력 필셀 값의 각 비트가 모두 1일 경우만 결과 픽셀 비트로 1이 반환
3. 논리합 (**OR**) : 두 입력 픽셀 값의 각 비트 중 하나라도 1이면 해당 결과 픽셀의 비트도 1이 반환된다
4. 배타적 논리합 (**XOR**) : 두 입력 픽셀 값의 각 비트가 서로 다를 경우에만 결과 픽셀의 해당 비트가 1이 반환된다


---

# 23-5. 연결 객체 검출 (Connected Component Labeling) & 외곽선 검출

## 1) 연결 객체 검출 (Labeling)

> 연결 객체란 ? (예시): 쌀알이 흩뿌려진 이미지에서 “쌀알이 총 몇 개고?” 세는 작업

- 이진 영상에서 픽셀 간의 연결성(4-Connected / 8-Connected 기준) 을 이용해 서로 인접한 픽셀들을 하나의 객체로 묶고, 각 영역에 레이블을 부여하는 기법이다

- 입력 영상은 배경(0)과 객체(255)로만 구성된 이진화된 이미지이며, 출력은 각 객체가 서로 다른 정수 ID로 표현된 **레이블 맵(Label Map)** 으로 나타난다

![image.png](/assets/img/opencv/3_opencv2_files/스크린샷%202025-11-26%20100845.png)

- 이진 영상 (Binary Image) 에서 연결 성분 (Connected Components) 를 추출하고 레이블링 (Labeling) 하는 과정
- 좌측 (입력): 픽셀 값이 0 (=검은색 또는 배경)과 0이 아닌 값(흰색 또는 객체)로만 구성된 이진 영상
- 우측 (출력) : 입력 이진 영상에서 서로 연결된 (붙어있는) 픽셀 그룹들을 각각 하나의 성분 (Component) 로 식별하고, 각 component 에 고유한 정수 레이블을 할당하여 얻은 레이블 맵


## 2) 외곽선 검출 (Contour Detection)


> 객체의 외곽선을 구성하는 좌표를 ***모두*** 추출하는 방법

![image-2.png](/assets/img/opencv/3_opencv2_files/스크린샷%202025-11-26%20111712.png)

- 보통 이진 마스크(Thresholding 결과)를 기반으로 수행
- 실제로는 정확한 마스크 획득이 어렵기 때문에 여전히 사람의 힘을 빌리거나, 딥러닝 기반 세그멘테이션 기법과 병행되는 경우가 많다

![스크린샷 2025-11-26 111704.png](/assets/img/opencv/3_opencv2_files/스크린샷%202025-11-26%20111704.png)

---

# 23-6. Hu’s Invariant Moments 를 이용한 객체 검출

## 모멘트 기반 객체 검출

> 유사한 이미지(좌) 를 가지고 객체 탐지를 한다 (우)

![image.png](/assets/img/opencv/3_opencv2_files/스크린샷%202025-11-26%20121541.png)

두 이미지의 **형태(Shape)** 를 비교하기 위해 사용되는 특징량

### 특징
- 모멘트 기반 객체 검출은 두 개의 외곽선, grayscale 영상을 이용하여 모양을 비교하는 방법이다
- 기본적으로 회전(rotate), 크기 변환(scale), 대칭, 이동 변환(translate)에 대하여 강력하고( **형태만 같다면 같은 객체로 인식 가능**), 객체자체에 변형이 생긴 경우에는(비선형 변형) 성능이 떨어진다
- 특정 함수 집합과의 상관 관계 (correlation) 형태로 계산

### 기하학적 모멘트 값

![image-2.png](/assets/img/opencv/3_opencv2_files/스크린샷%202025-11-26%20121828.png)

- 이러한 모멘트들을 조합해 만든 것이 Hu의 7가지 불변 모멘트(Hu Moments)다.

---


# 실시간 동영상 다루기

# 23-7. 배경 차분과 이동평균 배경 차분

## 1) 배경 차분 (Background Subtraction)

![image.png](/assets/img/opencv/3_opencv2_files/image.png)

- **배경 모델**(Background model) : 움직이는 객체가 없는 배경 영상  
- **현재 프레임**(Current frame) : 움직임(객체)이 포함된 현재 시점의 영상 
    - 이 예시에서는 빨간 자동차가 움직이는 객체

1. 차분 연산 (-) : 연산을 통해 배경은 0 에 가까운 값 (= 변화 없음) 을 가지고, 움직이는 객체의 영역은 큰 값 (= 변화 있음) 을 가지게 됨
    - *배경* 과 *현재 프레임* 두 영상을 뺀 후(차분), <u>큰 변화가 있는 부분만 객체로 판단</u>

2. 임계값 처리 (Threshold > ) : 차분 결과에 임계값 (Th) 를 적용해서 구분을 준다

3. 전경 마스크 (Foreground mask) : 임계값 처리의 결과로 얻어지는 이진 (binary) 이미지


## 2) 이동 평균 (Moving Average) 기반 배경 차분

> **시간이 지나면 오래된 객체는 '배경'으로 편입되는 방식**

- 예시 : 새로운 객체를 검출 >> 영상에 존재한지 5 분째 >> 검출 된지 오래된 객체는 배경(background)으로 처리를 해준다

- 특징 :
    - 매 프레임 유입될 때마다 배경을 조금씩 업데이트
    - 많은 프레임을 저장할 필요가 없어 메모리를 절약
    - 실내 CCTV, 도로 교통 영상에서 자주 사용됨

### 평균을 통한 배경 생성

1. 이동 평균 (Moving average) 이란 ?
    - 수백 장의 영상을 저장하는 대신 매 프레임이 들어올 때마다 평균 영상을 갱신

        ![스크린샷 2025-11-26 162924.png](/assets/img/opencv/3_opencv2_files/스크린샷%202025-11-26%20162924.png)

    - 대용량 버퍼 메모리가 필요하지 않음

2. 평균 연산에 의한 배경 영상 생성
    - 움직이는 객체가 존재하는 수백 장의 입력 영상으로부터 평균 영상을 구하면?

        ![image-3.png](/assets/img/opencv/3_opencv2_files/image-3.png)
        
        - 아주 많은 프레임을 모두 더하면, 그 자리에 가만히 있는 배경만 남는다
        - 움직이는 차량은 결과값에 나오지 않는다

    - 수백 장의 이전 프레임을 버퍼에 저장하려면 대용량 메모리가 필요하다

여러 프레임을 더해 평균을 내면 **지속적으로 움직이는 차량은 사라지고, 배경만 남는다.**

---

