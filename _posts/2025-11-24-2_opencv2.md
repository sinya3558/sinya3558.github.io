---
title:  "OpenCV (Part.2) : 기하학적 변환 (1)"
description: "OpenCV를 이용한 영상 필터링 원리(Mean, Gaussian, Sharpening, Bilateral)를 정리한 글 Part.1"
author: Seunga Kim
date: 2025-11-24
categories: [OpenCV, Computer Vision]
tag: [Image Filtering, Gaussian, Convolution]
toc: true
toc_label: "Table of Contents"
author_profile: True
comments: false

---

##### 📚 Reference: 
- 🔗 [양방향 필터](https://charlezz.com/?p=45025)
- 🔗 [OpenCV](https://wikidocs.net/231464)
- 🔗 두산 로키 5기 강의자료


# 22. OpenCV 를 이용한 기하학적 변환 Part.2 (1)

> 주제 및 내용 : **영상 필터링 (Filtering)** 의 원리를 이해하고, 이를 바탕으로 OpenCV 를 활용한 다양한 영상의 기하학적 변환 기법을 학습

> `Filtering` == `Convolution`

1. 평균 필터링, *가우시안* 필터링 원리

2. *샤프닝* 필터링, 양방향 필터링 원리

3. Affine transform 과 동차좌표계

4. 위치 이동, 회전이동

5. 영상확대, 전단변환 (Shearing)

6. OpenCV 를 이용한 영상 필터링

7. OpenCV 를 이용한 영상 Affine 변환

8. (Optional) OpenCV 를 이용한 영상 비선형변환 (Perspective transform)

---

## 영상 필터링

- 필터는 원본 이미지의 특정 영역 (빨간색으로 강조된 부분) 위에 놓여지고, 필터의 각 요소와 해당 영역의 픽셀 값이 곱해진 후 모두 더해서 결과를 계산한다
- 이 계산 결과 (-3) 가 새로운 이미지의 해당 위치 (빨간색 강조 부붖) 의 픽셀 값이 된다
- 이 과정이 필터가 원본 이미지 위를 <u>한 픽셀씩 이동(슬라이딩) 하면서 반복되어</u> 전체 결과 이미지를 생성한다

![image.png](/assets/img/opencv/2_opencv2_files/스크린샷%202025-11-24%20165521.png)

- 이미지의 *가장자리* (엣지) 에 대해서 분류 모델이 아닌 *영상 필터링에서는 그리 중요하지 않아* 어떤값을 대신 채워주던가, 제로 패딩을 하던가, 날려버리던가 한다.

<br>

## 서로 다른 필터에 따른 영상 변환 결과

- <u>Kernel 의 값들은 이미 각 필터에 맞춰 지정되어있다.</u> 그에 따른 인풋 이미지에 대한 결과값을 살펴보자

![image-2.png](/assets/img/opencv/2_opencv2_files/스크린샷%202025-11-24%20165945.png)

- identity 필터 : 이미지 그대로 출력. 사실상 이미지 복사(copy)
- Sharpen : 이미지가 샤프해짐
- **Mean Blur** ✨ : 블러링(평균값 필터)

![image-3.png](/assets/img/opencv/2_opencv2_files/스크린샷%202025-11-24%20170044.png)

- Laplacian : 엣지 찾는 필터

- **Gaussian Blur** ✨ : 가우시안 필터

# 22-1. 평균 필터링 + 가우시안 필터링의 원리

## 블러링 : 평균값 필터 (mean blur filter)

1. 평균값 필터 :
    > 평균값 필터 사용 목적은 블러링이다
    - 영상의 특정 좌표 값을 주변 픽셀 값들의 산술 평균으로 설정
        - <u>멀리 있는 픽셀의 영향을 많이</u> 받을 수 있음
        - 필터의 크기가 작을 수록(3x3) 블러링이 잘될까? 클수록(5x5) 잘될까?
            - 5x5 의 필터가 블러링이 더 잘 된다. 왜냐면 더 많은 영역을 가지고 평균을 내기때문에, 주변 픽셀들의 값들에서 영향을 더 많아 크면 클수록 최종 결과 픽셀이 더 흐릿해지는 현상이 나타난다

    - 픽셀들 간의 Grayscale 값 변화가 줄어들어 날카로운 엣지가 무뎌지고 부드러운 영상이 된다
    - 영상에 있는 noise 의 영향이 많이 사라지는 효과를 볼 수 있다.
        - 그러나 노이즈 제거용으로 평균 블러링 필터를 사용하지는 않는다

2. 필터의 종류 : 

![스크린샷 2025-11-24 170720.png](/assets/img/opencv/2_opencv2_files/스크린샷%202025-11-24%20170720.png)

3. 평균값 필터의 결과 비교 :

![스크린샷 2025-11-24 170757.png](/assets/img/opencv/2_opencv2_files/스크린샷%202025-11-24%20170757.png)

## 블러링 : 가우시안 필터 (Gaussian filter) ✨

> noise handling 목적으로 쓰이고, 또한 효과적으로 노이즈가 제거된다.

> 모든 이미지에는 noise 가 존재하고, 이미지를 이용해 Detection 또는 Segmentation 을 진행하기 위해서는 노이즈를 제거가 필수라서 효과적인 가우시안을 많이 사용한다

1. 가우시안 필터의 커널(kernel)

    ![image.png](/assets/img/opencv/2_opencv2_files/스크린샷%202025-11-24%20172522.png)

2. **가우시안 필터**

    - 이미지를 부드럽게 만들고 **노이즈를 효과적으로 제거**한다
    - 단순 평균 필터 (mean blur) 보다 더 자연스러운 블러링 효과를 제공하며, 엣지(경계선) 부분의 원본 이미지 정보를 비교적 잘 보존한다
    - **시그마 값 (=표준 편차)이 클수록** 더 넓은 영역의 픽셀에 영향을 미치므로 이미지가 **더 많이 흐려진다**

    <br>

    ![image-5.png](/assets/img/opencv/2_opencv2_files/스크린샷%202025-11-24%20173544.png)

    - Gaussian Distribution :  종 모양의 그래프 -> 정규 분포 = Gaussian
        - 평균값(mean) : 그래프의 중앙이 평균
        - 표준 편차(sigma) : 중앙에서 그래프까지의 거리
        - 영상 처리인 경우에는 mean 값은 보통 0이라 놔둬도 괜찮은데, <u>시그마 값은 조절 필수</u>

3. **시그마 값 조절하는 방법** : 
    - *시그마가 1* : 표준 정규 분포
    - *시그마가 1 보다 클수록*, 종모양 그래프는 -> 납작해진 호떡 그래프
        - 더 넓은 영역을 평균 내서 연산 진행 (5x5, 7x7 필터 등의 효과를 가짐)
    - *시그마가 1 보다 적을수록*, 종모양 그래프 -> 유니콘 뿔 모양 그래프
        - 더 좁은 영역 평균 계산 (3x3 필터와 유사한 효과 가짐)

        ![image-4.png](/assets/img/opencv/2_opencv2_files/스크린샷%202025-11-24%20173341.png)

4. 표준 편차 (시그마) 값에 따른 영상 변화 비교

    ![image-2.png](/assets/img/opencv/2_opencv2_files/스크린샷%202025-11-24%20173305.png)

## 블러링 : 평균값 필터와 가우시안 필터의 가중치 비교

![image-3.png](/assets/img/opencv/2_opencv2_files/스크린샷%202025-11-24%20174647.png)

1. 평균값 필터 : 거리와 상관없이 동일한 가중치로 평균 계산

2. 가우시안 필터 : 
    - 거리에 따라 가중치를 지정하여 평균을 계산. 자기자신과 가까울수록 높은 가중치, 멀리있을수록 적은 가중치 -> 자기 자신의 정보를 더 많이 보존
    - 노이즈 제거

# 22-2. 샤프닝 필터링, 양방향 필터링 원리

## 샤프닝 필터 (Sharpening Filter)

> 영상을 좀 더 선명하게 만드는 기법

![image.png](/assets/img/opencv/2_opencv2_files/image.png)

- (a) : 원본 
    - 1차원 밝기
    - 중간 경사 부분이 있어 엣지(경계)를 포함

- (b) : 블러링
    - 원본 영상에 블러링 필터 적용 (Gaussian)
    - 원본의 엣지 부분이 더 부드럽게(뭉게지게) 변형된 것을 볼 수 있음

- (c) : 원본과 블러링의 차이
    - 원본 영상에서 블러링 된 영상을 뺀 결과
    - Unsharp mask 라고 불리며, 에지 정보를 포함하고 있음

- (d) : 샤프닝 처리된 영상
    - (c) 에서 구한 차이를 원본 영상(a)에 다시 더한 결과
    - 이를 통해 원본의 엣지 부분이 더 강조되어 이미지가 더 선명해지는 효과를 가짐

    - 예시 이미지  : 

        ![image-2.png](/assets/img/opencv/2_opencv2_files/image-2.png)


## 양방향 필터 (Bilateral Filter)

> 대상 픽셀과 주변 픽셀과의 거리 그리고 픽셀 값의 **차이를 함께 고려**하여, **엣지를 보전**하는 블러 기법 중 하나

-  개념만 이해하면 된다

- 양방향 필터 연산식 : 

    ![image-5.png](/assets/img/opencv/2_opencv2_files/image-5.png)

### 가우시안 필터 vs. 양방향 필터의 차이점

1. 가우시안

    ![image-3.png](/assets/img/opencv/2_opencv2_files/image-3.png)

    - output : 이미지가 불분명하다

    - 단점 : 주변 픽셀과 중앙 픽셀의 명암비가 극명할 때, (예 : 하나의 픽셀안에 절반은 하늘, 절반은 바위) 이런 경우 가우시안 필터를 사용하여 컨볼루션을 하면 결과가 뭉개진다 -> 즉, 정보 손실이 크게 일어난다.

2. 양뱡향 

    ![image-4.png](/assets/img/opencv/2_opencv2_files/image-4.png)

    - 가우시안 필터의 장점을 보완한 필터
        - 픽셀 안의 명암비(색상 차이)가 극명할 때, 컨볼루션을 진행 하지 않도록 weight 를 줄어 주는 기법
    
    - 양방항 필터에서 중요하게 다루는 포인트 2 가지
        1. `공간적 거리 (Spatial Closeness)` : 필터의 중심 픽셀로부터 물리적인 거리가 가까운 픽셀에 더 큰 가중치를 부여한다(가우시안과 동일한 원리)
        2. `강도 유사성 (Intensity Similarity)` : 필터의 중심 픽셀ㄹ과 강도(밝기 또는 색상) 값이 비슷한 픽셀에 더 큰 가중치를 부여한다

